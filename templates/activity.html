<ion-header-bar class="bar-positive">
    <a href="#"><button class="button button-icon ion-ios7-arrow-back"></button></a>
    <h1 class="title">Activity</h1>
    <button class="button button-icon ion-edit" ng-hide="activity.completed.done" ng-click="openActivityForm()"></button>
</ion-header-bar>

<ion-content class="has-header padding">

    <div class="card">
        <div class="item item-divider">
            {{activity.title}}
        </div>
        <div class="row">
            <div class="col col-30">Completed</div>
            <div class="col">
                <label class="toggle">
                    <input type="checkbox" ng-model="activity.completed.done" ng-change="saveCompleted()">
                    <div class="track">
                        <div class="handle"></div>
                    </div>
                </label>
                <!--<input type="checkbox" ng-model="activity.completed.done" ng-change="saveActivity()">-->
            </div>
        </div>
        <div class="row" ng-show="activity.completed.done">
            <div class="col col-30">By:</div>
            <div class="col">
                <!--ng-change only fires once?-->
                <select ng-model="activity.completed.by" ng-change="saveDoer()">
                    <option value="" disabled selected>Select a user</option>
                    <option value="all">All</option>
                    <option value="evi">Evi</option>
                    <option value="toma">Toma</option>
                </select>
            </div>
        </div>
        <div ng-class="{greyOut:activity.completed.done}">
            <div class="row">
                <div class="col col-30">Urgency:</div>
                <div class="col">{{activity.urgency}}</div>
            </div>

            <div class="row">
                <div class="col col-30">Estimated Duration:</div>
                <div class="col">{{activity.duration  || "not specified"}}</div>
            </div>

            <div class="row">
                <div class="col col-30">Context:</div>
                <div class="col">
                    <span ng-repeat="(key, item) in activity.context" ng-show="item">{{key}}<span ng-show="!$last ">, </span></span>

                </div>
            </div>

            <div class="row">
                <div class="col col-30">For:</div>
                <div class="col">
                    <span ng-repeat="(key, user) in activity.forUsers" ng-show="user">{{key}}<span ng-show="!$last ">, </span></span>
                </div>
            </div>

            <div class="row">
                <div class="col col-30">Instructions</div>
                <div class="col">
                    {{ activity.instructions || "none" }}
                </div>
            </div>

            <div class="row">
                <div class="col col-30">Added on:</div>
                <div class="col">
                    {{activity.date | date}}
                </div>
            </div>
        </div>
    </div>
    <button class="button button-primary" ng-click="deleteActivity()">Delete</button>

    <div>
        <p>points given: {{activity.completed.points}}</p>
        <p>Evi has {{users.evi.points}} points.<br />
        Toma has {{users.toma.points}} points.</p>
    </div>
</ion-content>
